package pocscan

import (
	"testing"
)

func TestNuclei_ParseResult(t *testing.T) {
	content := `{"template":"http/technologies/springboot-actuator.yaml","template-url":"https://cloud.projectdiscovery.io/public/springboot-actuator","template-id":"springboot-actuator","template-path":"/Users/user/nuclei-templates/http/technologies/springboot-actuator.yaml","info":{"name":"Detect Springboot Actuators","author":["that_juan_","dwisiswant0","wdahlenb","dr0pd34d"],"tags":["tech","springboot","actuator"],"severity":"info","metadata":{"max-request":4,"shodan-query":"http.favicon.hash:116323821"}},"type":"http","host":"172.16.222.1:18080","port":"18080","scheme":"http","url":"http://172.16.222.1:18080","matched-at":"http://172.16.222.1:18080","request":"GET / HTTP/1.1\r\nHost: 172.16.222.1:18080\r\nUser-Agent: Mozilla/5.0 (ZZ; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/125.0.0.0 Safari/537.36\r\nConnection: close\r\nAccept: */*\r\nAccept-Language: en\r\nAccept-Encoding: gzip\r\n\r\n","response":"HTTP/1.1 200 OK\r\nConnection: close\r\nContent-Length: 164\r\nContent-Type: text/html\r\nDate: Sun, 23 Feb 2025 07:41:47 GMT\r\nServer: Servlet/2.0\r\n\r\n\u003c!DOCTYPE html\u003e\u003chtml\u003e\u003cheader\u003e\u003ctitle\u003eapplicationConfig\u003c/title\u003e\u003c/header\u003e\u003cbody\u003elocal.server.port:18080\u003ch2\u003e\"_links\":\u003c/h2\u003e\u003ch2\u003e\"self\":\u003c/h2\u003e\u003ch2\u003e\"health\"\u003c/h2\u003e\u003c/body\u003e\u003c/html\u003e","ip":"172.16.222.1","timestamp":"2025-02-23T15:41:47.588078+08:00","curl-command":"curl -X 'GET' -H 'Accept: */*' -H 'Accept-Language: en' -H 'User-Agent: Mozilla/5.0 (ZZ; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/125.0.0.0 Safari/537.36' 'http://172.16.222.1:18080'","matcher-status":true}
{"template":"http/technologies/springboot-actuator.yaml","template-url":"https://cloud.projectdiscovery.io/public/springboot-actuator","template-id":"springboot-actuator","template-path":"/Users/user/nuclei-templates/http/technologies/springboot-actuator.yaml","info":{"name":"Detect Springboot Actuators","author":["that_juan_","dwisiswant0","wdahlenb","dr0pd34d"],"tags":["tech","springboot","actuator"],"severity":"info","metadata":{"max-request":4,"shodan-query":"http.favicon.hash:116323821"}},"type":"http","host":"127.0.0.1:18080","port":"18080","scheme":"http","url":"http://127.0.0.1:18080","matched-at":"http://127.0.0.1:18080","request":"GET / HTTP/1.1\r\nHost: 127.0.0.1:18080\r\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.3 Safari/605.3.25\r\nConnection: close\r\nAccept: */*\r\nAccept-Language: en\r\nAccept-Encoding: gzip\r\n\r\n","response":"HTTP/1.1 200 OK\r\nConnection: close\r\nContent-Length: 164\r\nContent-Type: text/html\r\nDate: Sun, 23 Feb 2025 07:41:47 GMT\r\nServer: Servlet/2.0\r\n\r\n\u003c!DOCTYPE html\u003e\u003chtml\u003e\u003cheader\u003e\u003ctitle\u003eapplicationConfig\u003c/title\u003e\u003c/header\u003e\u003cbody\u003elocal.server.port:18080\u003ch2\u003e\"_links\":\u003c/h2\u003e\u003ch2\u003e\"self\":\u003c/h2\u003e\u003ch2\u003e\"health\"\u003c/h2\u003e\u003c/body\u003e\u003c/html\u003e","ip":"127.0.0.1","timestamp":"2025-02-23T15:41:47.588059+08:00","curl-command":"curl -X 'GET' -H 'Accept: */*' -H 'Accept-Language: en' -H 'User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.3 Safari/605.3.25' 'http://127.0.0.1:18080'","matcher-status":true}`
	n := Nuclei{}
	result := n.ParseContentResult([]byte(content))
	for authority, vuls := range result.VulResult {
		t.Log(authority, vuls)
	}

}
